<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="jetbot_mirea">

    <!--
    TODO:
    ✅1. Подключение модели камеры Intel Realsense
    2. Починить отсутствия СК колес
    3. Привязать Rplidar A2
    4. Проверить привязку к реальному роботу
    5. Запилить работу модели с Gazebo
    6. Починить, что сбиваются преобразования систем координат
    7. ???
    ✅8. Разобраться, что за файлики *.rviz
        -->

    <xacro:arg name="use_nominal_extrinsics" default="false"/>
    <xacro:arg name="add_plug" default="false" />
    <xacro:arg name="use_mesh" default="true" />

    <xacro:include filename="common_properties.xacro"/>
    <xacro:include filename="$(find jetbot_mirea_description)/urdf/_d435.urdf.xacro" />
    
    <link name="base_footprint"/>
    
    <joint name="base_joint" type="fixed">
        <parent link="base_footprint"/>
        <child link="base_link"/>
        <origin xyz="0.0 0.0 0.01" rpy="0 0 0"/>
    </joint>

    <link name="base_link">
        <visual>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
            <geometry>
                <mesh filename="package://jetbot_mirea_description/meshes/jetbot_base.stl" scale="0.001 0.001 0.001"/>
                <box size="0.132 0.095 0.032"/>
            </geometry>
            <material name="acid_green"/>
        </visual>

        <collision>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
            <geometry>
                <box size="0.132 0.095 0.032"/>
            </geometry>
        </collision>

        <xacro:inertial_box mass="0.005" x="0.132" y="0.095" z="0.032">
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        </xacro:inertial_box>
        
    </link>

    <joint name="wheel_left_joint" type="continuous">
        <parent link="base_link"/>
        <child link="wheel_left_link"/>
        <origin xyz="0.0 0.08 -0.005" rpy="-1.57 0 0"/>
        <!-- <axis xyz="0 0 1"/> -->
    </joint>

    <link name="wheel_left_link">
        <visual>
            <origin xyz="0 0.08 -0.005" rpy="1.57 0 0"/>
            <geometry>
                <mesh filename="package://jetbot_mirea_description/meshes/jetbot_left_wheel.stl" scale="0.001 0.001 0.001"/>
                <!-- <cylinder length="0.005" radius="0.032"/> -->
            </geometry>
            <material name="dark"/>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <cylinder length="0.029" radius="0.032"/>
            </geometry>
        </collision>

        <xacro:inertial_cylinder mass="0.001" length="0.029" radius="0.032">
            <origin xyz="0.0 -0.06 -0.005" rpy="0.0 0.0 0.0"/>
        </xacro:inertial_cylinder>

    </link>

    <joint name="wheel_right_joint" type="continuous">
        <parent link="base_link"/>
        <child link="wheel_right_link"/>
        <origin xyz="0 -0.08 -0.005" rpy="-1.57 0 0"/>
        <!-- <axis xyz="0 0 1"/> -->
    </joint>

    <link name="wheel_right_link">
        <visual>
            <origin xyz="0.0 -0.08 -0.005" rpy="1.57 0 0"/>
            <geometry>
                <mesh filename="package://jetbot_mirea_description/meshes/jetbot_right_wheel.stl" scale="0.001 0.001 0.001"/>
                <!-- <cylinder length="0.005" radius="0.032"/> -->
            </geometry>
            <material name="dark"/>
        </visual>
       
        <collision>
            <origin xyz="0 0.06 -0.005" rpy="1.57 0 0"/>
            <geometry>
                <cylinder length="0.029" radius="0.032"/>
            </geometry>
        </collision>
        
        <xacro:inertial_cylinder mass="0.0010" length="0.029" radius="0.032">
            <origin xyz="0 0.06 -0.005" rpy="0 0 0"/>
        </xacro:inertial_cylinder>
    </link>

    <joint name="upperplate_joint" type="fixed">
        <parent link="base_link"/>
        <child link="upperplate_link"/>
        <origin xyz="0.0 0.0 0.098" rpy="0 0 0"/>
    </joint>

    <link name="upperplate_link">
        <visual>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
            <geometry>
                <box size="0.126 0.085 0.005"/>
            </geometry>
            <material name="dark"/>
        </visual>

        <collision>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
            <geometry>
                <box size="0.126 0.085 0.005"/>
            </geometry>
        </collision>

        <xacro:inertial_box mass="0.002" x="0.126" y="0.085" z="0.005">
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        </xacro:inertial_box>
    </link>

    <joint name="marvelmind_joint" type="fixed">
        <parent link="base_link"/>
        <child link="marvelmind_link"/>
        <origin xyz="0.0 0.0 0.103" rpy="0 0 0"/>
    </joint>

    <link name="marvelmind_link">
        <visual>
            <origin xyz="0.01 -0.01 0.0" rpy="0 0 1.57"/>
            <geometry>
                <mesh filename="package://jetbot_mirea_description/meshes/marvelmind_miniRX.stl" scale="0.001 0.001 0.001"/>
                <!-- <box size="0.06 0.04 0.007"/> -->
            </geometry>
            <material name="dark"/>
        </visual>

        <collision>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
            <geometry>
                <box size="0.06 0.04 0.007"/>
            </geometry>
        </collision>

        <xacro:inertial_box mass="0.0005" x="0.06" y="0.04" z="0.007">
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        </xacro:inertial_box>
    </link>

    <joint name="realsense_plate_joint" type="fixed">
        <parent link="upperplate_link"/>
        <child link="realsense_plate_link"/>
        <origin xyz="0.066 0.0 0.006" rpy="0 0 0"/>
    </joint>

    <link name="realsense_plate_link">
        <visual>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
            <geometry>
                <box size="0.005 0.085 0.022"/>
            </geometry>
            <material name="dark"/>
        </visual>

        <collision>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
            <geometry>
                <box size="0.005 0.085 0.022"/>
            </geometry>
        </collision>

        <xacro:inertial_box mass="0.0001" x="0.005" y="0.085" z="0.022">
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        </xacro:inertial_box>
    </link>

    <joint name = "realsense_joint" type="fixed">
        <parent link="realsense_plate_link"/>
        <child link="realsense_link"/>
        <origin xyz="0.006 0.0 0.0" rpy="0 0 0"/>
    </joint>

    <link name="realsense_link" />
        <xacro:sensor_d435 parent="realsense_plate_link" name="d435" use_nominal_extrinsics="$(arg use_nominal_extrinsics)" add_plug="$(arg add_plug)" use_mesh="$(arg use_mesh)">
        <origin xyz="0.012 0 0" rpy="0 0 0"/>
    </xacro:sensor_d435>



    <joint name="sci_camera_plate_joint" type="fixed">
        <parent link="base_link"/>
        <child link="sci_camera_plate_link"/>
        <origin xyz="-0.066 0.0 0.09" rpy="0 0.65 3.14"/>
    </joint>

    <link name="sci_camera_plate_link">
        <visual>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
            <geometry>
                <box size="0.005 0.02 0.022"/>
            </geometry>
            <material name="acid_green"/>
        </visual>

        <collision>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
            <geometry>
                <box size="0.005 0.02 0.022"/>
            </geometry>
        </collision>

        <xacro:inertial_box mass="0.0001" x="0.005" y="0.085" z="0.022">
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        </xacro:inertial_box>
    </link>

    <joint name="sci_camera_joint" type="fixed">
        <parent link="sci_camera_plate_link"/>
        <child link="sci_camera_link"/>
        <origin xyz="0.005 0.0 0.0" rpy="0 0.0 0.0"/>
    </joint>

    <link name="sci_camera_link">
        <visual>
            <origin xyz="0.0035 0.0 0.0" rpy="0 1.6 0"/>
            <geometry>
                <cylinder length="0.015" radius="0.01"/>
            </geometry>
            <material name="black"/>
        </visual> 

        <collision>
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
            <geometry>
                <box size="0.005 0.085 0.022"/>
            </geometry>
        </collision>

        <xacro:inertial_box mass="0.0001" x="0.005" y="0.085" z="0.022">
            <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        </xacro:inertial_box>
    </link>

  <joint name="rplidar_joint" type="fixed">
    <parent link="base_link"/>
    <child link="rplidar_link"/>
    <origin xyz="0.109 0.0 -0.003" rpy="3.14 0.0 0.0"/>
  </joint>

  <link name="rplidar_link">
    <visual>
        <origin xyz="0.0 0.0 0.0" rpy="3.14 0 0"/>
            <!--<geometry>
                <cylinder length="0.038" radius="0.036"/>
            </geometry>-->
        <geometry>
            <cylinder length="0.038" radius="0.036"/>
            <!--<mesh filename="package://jetbot_mirea_description/meshes/sensors/lds.stl" scale="0.01 0.01 0.01"/>-->
        </geometry>
        <material name="dark"/>
    </visual>

        <collision>
            <origin xyz="0.0 0.0 0.0" rpy="3.14 0 0"/>
            <geometry>
                <cylinder length="0.038" radius="0.036"/>
            </geometry>
        </collision>

        <xacro:inertial_cylinder mass="0.01" length="0.038" radius="0.036">
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
        </xacro:inertial_cylinder>
    </link>
</robot>